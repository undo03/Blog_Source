---
title: 面向对象原型链和原型链查找机制
subtitle: Archetypal_chain
tags: [原型链, JS]
date: 2017-06-23
categories: JavaScript
description:
---

原型链相关知识在找工作面试中很高概率会被问到,以及面向对象,继承等相关知识.本文以之前面试中被问到的两个典型面试题来理解原型链.

<!--more-->

### 面试题 1

```javascript
function Fn() {}
let f = new Fn()

// 填空题 填入适当的值使以下等式成立
f._________ === Fn.___________
```

### 面试题 2

```javascript
Function.prototype.a = 1
Object.prototype.b = 2
function Fn() {}
let f = new Fn()
console.log(f.a, f.b)
```

这两道题并不难,但是很考验基本功掌握的扎实程度,要能完全答对需要搞清楚原型链的相关知识,搞清楚 `Object`, `Function`, `prototype`, `__proto__`之间的关系.

先来了解一下基本概念.

### 1. 基本概念

#### 1.1 原型 prototype

每个函数都有一个属性 `prototype`, 它是一个对象,它有最基本的两个属性 `constructor` 指向函数本身

```javascript
function Fn() {}
Fn.prototype = {
    constructor: Fn,
    ...
}
```

> 一般情况下`prototype`都是 `object` 类型的, 但有一个例外 `Function.prototype` 是 `function` 类型的 

```javascript
function Fn() {}
console.dir(Fn)
console.log(typeof Function.prototype) // function
console.log(typeof Fn.prototype) // object
```

#### 1.2 `__proto__`

每一个对象数据类型(`普通的对象`、`实例`、`prototype`等)也都有一个属性：`__proto__`，属性值是当前对象所属类的原型

那么到这里,第一道面试题的答案也就明了了, `f` 是 `Fn`的实例,是一个普通对象`object`类型,那么它的`__proto__`指向的是`Fn,prototype`

所以答案就是 `f.__proto__ === Fn.prototype`

```javascript
function Fn() {}
let f = new Fn()
console.log(typeof f) // object
console.log(f.__proto__ === Fn.prototype) // true
```
> 但是,在`Object.prototype`上没有`__proto__`这个属性, 因为 `Object`是JS中所有对象数据类型的基类,位于原型链的最顶端

那么第二题的解法也是根据 `prototype` 和 `__proto__` 来进行查找的, 这里先了解一下原型链的查找机制 

### 2. 原型链查找机制

1. 通过 对象名.属性名 的方式获取属性值的时候,首先在对象的私有的属性上进行查找,如果私有中存在这个属性,则获取的是私有的属性值.
2. 如果私有的没有,则通过 `__proto__` 找到所属类的原型(类的原型上定义的属性和方法都是当前实例公有的属性和方法),原型上存在的话,获取的是公有的属性值
3. 如果原型上也没有,则继续通过原型上的 `__proto__` 继续向上查找,一直找到 `Object.prototype` 为止...

这就是 `原型链查找机制`

第二题中`f.a` , `f.b`,首先我们会在`f`的私有属性上找这两个属性,则根据 `原型链查找机制` 继续向上找,最终在 `Object` 的原型上找到 `b`,而没找到 `a`,所以答案是 ` undefined 2`

那么怎么取到 `a` 呢 ,  `Fn.a` 则可以根据  `原型链查找机制`  在 `Function` 的原型上找到

来看下面这张图,大致了解一下JS世界中所有数据类型的原型关系

![](https://github.com/undo03/undo03.github.io/blob/master/article_images/JavaScript/archetypal_chain.png?raw=true)

### 总结一下

原型链,原型链查找 并不难, 掌握一下几条法则即可轻松搞定

1. 每一个函数数据类型(普通函数、类)都有自带的属性:`prototype`,并且这个属性是一个对象数据类型的值,指向原型
2. 每一个对象数据类型的值都有 `__proto__` 属性,指向该对象所属类的原型
3. `原型链查找机制` 进行 `对象名.属性名` 取值
4. 每一个函数 都是 `Function` 的实例, 所以 函数 也有 `__proto__` 属性,指向 `Function.prototype`

有意思的是 `Object.__proto__` 指向的是 `Function.prototype`, 而 `Function.prototype.__proto__` 指向了 `Object.prototype`, `Function.__proto__` 也指向了 `Function.prototype` 

```javascript
console.log(Object.__proto__ === Function.prototype)  // true
console.log(Function.prototype.__proto__ === Object.prototype)  // true
console.log(Function.prototype === Function.__proto__)  // true
```