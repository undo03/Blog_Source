---
title: 类数组转化成数组
subtitle: js_list_to_array
tags: [JS, 类数组]
date: 2017-08-20
categories: JavaScript
description:
---

类数组是很常见的一种数据结构, 它与数组的结构非常相似, 同时有着数组的很多特性, 很多时候会想着按数组的处理方式来使用他们, 但是我们都知道数组的方法都是封装在 `Array.prototype` 上的, 所以类数组是无法直接使用数组原型上的方法的, 要达到这样的目的, 就需要将类数组转化成数组.

常见的类数组有: `arguments`、`HTMLCollection` 的实例、`NodeList`的实例...

<!--more-->

类数组虽然结构特点无限接近数组,但是并不是 `Array`的实例,所以也是无法调取数组原型上的那些方法的,想要调取的话有以下三种方案：

### 1. 把类数组转化为数组 

```javascript
function listToArray(likeAry) {
    var ary = [];
    for (var i = 0, len = likeAry.length; i < len; i++) {
        ary[ary.length] = likeAry[i];
    }
    return ary;
}
```

通过这种方式将类数组移植成数组的实例, 就可以愉快使用数组的各种方法了

### 2. 直接借用数组原型上的方法(call/apply)

```javascript
function fn() {
    console.log(arguments);
    //arguments.slice(); // Uncaught TypeError: arguments.slice is not a function
    console.log([].slice.call(arguments));
    console.log([].slice.apply(arguments));
    console.log(Array.apply(null, arguments));
    console.log(Array.prototype.slice.call(arguments));
}
fn(12, 23, 34);
```

利用 `call/apply` 借用数组原型上的方法也可以达到同样的效果

**注意**: `IE8` 及以下浏览器中，DOM对象组成的类数组通过call调用slice方法没有遵循标准行为, 因此DOM元素组成的类数组无法直接通过借用slice方法转换成数组

以上两种可以做个兼容处理, 合成一种兼容比较好的函数

```javascript
function listToArray(likeAry) {
    var ary = [];
    try {
        ary = Array.prototype.slice.call(likeAry);
    } catch (e) {
        for (var i = 0, len = likeAry.length; i < len; i++) {
            ary[ary.length] = likeAry[i];
        }
    }
    return ary;
}
```

### 3. 使用中间继承改变原型指向

从其它角度理解, 为什么arguments不能直接调取数组的方法: 一个真正的数组的`__proto__` 指向的是 `Array.prototype`, 所以可以调取这里的方法, 而`arguments.__proto__ === Object.prototype`, 所以只能调取对象基类原型上的方法

那么可以通过这一特性强行改变类数组实例的 `__proto__` 的指向, 使其指向数组的原型

```javascript
function fn() {
    arguments.__proto__ = Array.prototype;
    console.log(arguments.reverse());
}
fn(12, 23, 34);
```

**注意**: 在IE浏览器中,为了防止用户恶意修改内置对象的原型指向,是禁止使用__proto__这个属性的, 所以这只能算是一种 **奇技淫巧**, 了解就好
但是在移动端开发中,不需要考虑IE,使用这种方式还是非常方便的

